generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}


// ---- Reservation/reservation.prisma ----
enum ReservationStatus {
  BOOKED
  PAID
}
model Reservation {
  id         String   @id @default(uuid())
  tableId    String
  table      Table    @relation(fields: [tableId], references: [id], onDelete: Cascade)
  startTime  DateTime
  endTime    DateTime
  reservedBy String
  totalGuest Int
  Note       String
  Date       DateTime
  Status     ReservationStatus
  @@map("table_reservation")
}

// ---- customerCredit/customerCredit.prisma ----
model CustomerCredit {
  id              String   @id @default(uuid())
  shopCustomerId  String
  shopCustomer    ShopCustomer @relation(fields: [shopCustomerId], references: [id])
  orderId         String?  // optional, set when credit was taken
  transactionId   String?  // optional, set when repayment is made
  amountReceived  Float    // input from body
  previousCredit  Float    // credit before payment (from ShopCustomer)
  updatedCredit   Float    // credit after payment (calculated)
  creditLimit     Float    // from ShopCustomer at the time of payment
  createdAt       DateTime @default(now())
}

// ---- offers/offers.prisma ----
model Offer {
  id          String   @id @default(uuid())
  title       String
  shopId      String
  shop        Shop     @relation(fields: [shopId], references: [id])
  buyItemId   String
  buyItem     ShopProduct @relation("BuyItemRelation", fields: [buyItemId], references: [id])
  buyQuantity Int
  getItemId   String
  getItem     ShopProduct @relation("GetItemRelation", fields: [getItemId], references: [id])
  getQuantity Int
  validFrom   DateTime
  validTo     DateTime
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}

// ---- order/order.prisma ----
enum OrderStatus {
  pending
  cancelled
  completed
  prepared
  reverted
}
enum OrderType {
  dine_in
  takeaway
  delivery
}
model PaymentDistribution {
  id            String      @id @default(uuid())
  paymentModeId String
  paymentMode   PaymentMode @relation(fields: [paymentModeId], references: [id])
  amount        Float
  status  OrderStatus @default(completed)
  orderId String
  order   Order       @relation(fields: [orderId], references: [id])
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}
model Order {
  id String @id @default(uuid())
  shopId String
  shop   Shop?  @relation(fields: [shopId], references: [id])
  // Optional relation to Table
  tableId String?
  table   Table?  @relation(fields: [tableId], references: [id])
  orderType OrderType   @default(dine_in)
  status    OrderStatus @default(pending)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  totalAmount Float
  // Optional relation to TableGroup
  tableGroupId String?
  tableGroup   TableGroup? @relation(fields: [tableGroupId], references: [id])
  // Unique token and token number
  token       String? @unique
  tokenNumber Int?
  // Parent Order relation (self-relation)
  parentOrderId String?
  parentOrder   Order?  @relation("OrderToChildOrders", fields: [parentOrderId], references: [id])
  childOrders   Order[] @relation("OrderToChildOrders")
  // Customer information (nullable)
  customerName    String?
  customerPhone   String?
  customerEmail   String?
  deliveryAddress String?
  notes           String?
  // ProductRequests (one-to-many)
  productRequests      ProductRequest[]
  paymentDistributions PaymentDistribution[]
  transaction          Transaction?
  shopTransaction      ShopTransaction?
  //shop Customer Relation Also  nullable 
  shopCustomerId String?
  shopCustomer   ShopCustomer? @relation(fields: [shopCustomerId], references: [id])
  proceedWithoutBilling Boolean @default(false)
  @@map("order") // Optional: map to DB table name
}

// ---- paymentModes/paymentModes.prisma ----
model PaymentMode {
  id        String   @id @default(uuid())
  name      String
  icon      String?     // optional icon path or URL
  qrCode    String?     // optional QR code URL or base64
  isActive  Boolean  @default(true)
  shopId    String
  shop      Shop     @relation(fields: [shopId], references: [id])
  createdAt DateTime @default(now())
  paymentDistributions PaymentDistribution[]
  @@unique([name, shopId])
}

// ---- printSetting/printSetting.prisma ----
model PrintSetting {
  id                 String   @id @default(uuid())
  shopId             String   @unique
  shop               Shop     @relation(fields: [shopId], references: [id])
  enablePrint        Boolean  @default(true)
  showStoreDetails   Boolean  @default(true)
  showCustomerDetails Boolean @default(true)
  format             String   // "80mm", "57mm", etc.
  header             String?
  footer             String?
  showNotes          Boolean  @default(true)
  printToken         Boolean  @default(true)
  updatedAt          DateTime @updatedAt
  createdAt          DateTime @default(now())
}

// ---- product/product.prisma ----
model Product {
  id              String              @id @default(uuid())
  name            String
  description     String?          
  costPrice       Float          
  sellingPrice    Float          
  shopCategoryId  String?          // Nullable FK to ShopCategory (UUID based)
  productCategoryId      String              // FK to ProductCategory
  productImageUrl String?
  createdAt       DateTime         @default(now())
  updatedAt       DateTime         @updatedAt
  // Relations
  productCategory  ProductCategory  @relation(fields: [productCategoryId], references: [id])
  shopCategory     ShopCategory?    @relation(fields: [shopCategoryId], references: [id])
  shopProducts     ShopProduct[]
  @@map("product") // Optional: maps Prisma model to 'product' DB table
}

// ---- productCategory/productCategory.prisma ----
model ProductCategory {
  id                       String                @id @default(uuid())
  name                     String
  description              String?            
  createdAt                DateTime           @default(now())
  updatedAt                DateTime           @updatedAt
  // One-to-many with Product
  products                 Product[]
  shopId    String
  shop         Shop           @relation(fields: [shopId], references: [id]) 
shopCategoryId String
shopCategory   ShopCategory? @relation("ShopCategoryToProductCategory", fields: [shopCategoryId], references: [id])
  // Self-relation: parent-child categories
  productParentCategoryId  String?
  productParentCategory    ProductCategory?   @relation("CategoryHierarchy", fields: [productParentCategoryId], references: [id])
  children                 ProductCategory[]  @relation("CategoryHierarchy")
}

// ---- productRawMaterials/productRawMaterials.prisma ----
model ProductComponentRawMaterial {
  id             String          @id @default(uuid())
  shopProductId  String?         
  shopProduct    ShopProduct?    @relation(fields: [shopProductId], references: [id], onDelete: Cascade)
  addonId        String?         
  addon          ShopProductAddon? @relation(fields: [addonId], references: [id], onDelete: Cascade)
  rawMaterialId  String
  rawMaterial    RawMaterial     @relation(fields: [rawMaterialId], references: [id], onDelete: Cascade)
  quantity       Float
}

// ---- productRequest/productRequest.prisma ----
enum ProductRequestStatus {
  pending
  approved
  declined
  completed
  preparing
  reverted
}
model ProductRequest {
  id String @id @default(uuid())
  shopProductId String
  shopProduct   ShopProduct @relation(fields: [shopProductId], references: [id])
  customerId String? // nullable, linked later
  message     String?
  soldAtPrice Float   @default(-1.0)
  quantity    Int     @default(1)
  groupId     String? // nullable
  status ProductRequestStatus @default(pending)
  responseMessage String? @db.Text
  createdAt DateTime @default(now())
  orderId String? // nullable
  order   Order?  @relation(fields: [orderId], references: [id])
  addons ProductRequestAddon[] @relation("RequestToAddon")
  @@map("product_request") // optional: maps to DB table name
}

// ---- productRequestAddon/productRequestAddon.prisma ----
model ProductRequestAddon {
  id                String             @id @default(uuid())
  productRequestId  String
  productRequest    ProductRequest     @relation("RequestToAddon", fields: [productRequestId], references: [id])
  addonId           String
  addon             ShopProductAddon   @relation(fields: [addonId], references: [id])
  @@map("product_request_addon")
}

// ---- rawMaterials/rawMaterials.prisma ----
enum RawMaterialUnitType {
  kg
  g
  l
  ml
  pcs
  // Add more as needed
}
model RawMaterial {
  shopId                String
  shop                  Shop                     @relation(fields: [shopId], references: [id])
  id                     String                        @id @default(uuid())
  name                   String
  current_stock_quantity Float                         @default(0)
  minimum_stock_quantity Float                         @default(0)
  cost_price             Float                         @default(0)
  unit                   RawMaterialUnitType
  productConsumptions    ProductComponentRawMaterial[]
  createdAt      DateTime       @default(now())
  updatedAt      DateTime       @updatedAt
  @@map("raw_materials") // Optional: maps to existing SQL table name
}

// ---- resturant/restaurant.prisma ----
model Restaurant {
  id             String   @id @default(uuid())
  slug           String?
  name           String
  shortName      String?
  description    String?
  thumbnail      String?
  address        String?
  city           String?
  latitude       Float?
  longitude      Float?
  images         String[]
  menuImages     String[]
  logoImage      String?
  coverImage     String?
  avgSpending    String?
  vector         String?
  phone          String?
  email          String?
  website        String?
  openingHours   String?
  closingHours   String?
  cuisine        String?
  features       String[]
  avgRating      Float?
  reviewCount    Int?
  imageUrl       String?
  createdAt      DateTime  @default(now())
  updatedAt      DateTime  @updatedAt
  views          Int?       @default(0)
  @@map("restaurant")
}

// ---- shop/shop.prisma ----
enum ShopStatus {
  pending
  approved
  rejected
}
enum ShopType {
  product
  service
}
model Shop {
  id                String     @id @default(uuid())
  merchantId        String
  name              String
  email             String?
  shopCategoryId    String?
  productCategoryId String?
  phoneNumbers      String[]
  address           String?
  mapCoordinates    String?
  openHour          String?
  closeHour         String?
  status            ShopStatus @default(approved)
  type              ShopType?
  verified          Boolean    @default(false)
  createdAt         DateTime   @default(now())
  updatedAt         DateTime   @updatedAt
  // Relations
  merchant           Merchant              @relation(fields: [merchantId], references: [id])
  category           ProductCategory[]
  shopCategory       ShopCategory?          @relation(fields: [shopCategoryId], references: [id])
  shopProducts       ShopProduct[]
  tables             Table[] // Optional
  tableGroup         TableGroup[]
  shopProductCategory ShopProductCategory[] // Optional
  shopProductSubCategory ShopProductSubCategory[] // Optional
  rawMaterials       RawMaterial[]
  orders             Order[]
  shopCustomers    ShopCustomer[]
  transactions     Transaction[]
  shopTransactions ShopTransaction[]
  shopTax          ShopTax[]
  paymentMode      PaymentMode[]
  printSetting     PrintSetting[]
  soundSetting     SoundSetting[]
  offers           Offer[]
  colors            ShopProductColor[]
  brands           ShopProductBrand[]
  staffs           Staff[]           @relation("ShopStaff")
  parties          ShopParty[]
  expenses         ShopExpense[]
  @@map("shop") // Optional: only if your DB table is named `shop`
}

// ---- shopCategory/shopCategory.prisma ----
model ShopCategory {
  id               String               @id @default(uuid())
  name             String
  description      String?           @db.Text
  parentCategoryId String?             
  parentCategory   ShopCategory?     @relation("ParentChild", fields: [parentCategoryId], references: [id])
  subCategories    ShopCategory[]    @relation("ParentChild")
  createdAt        DateTime          @default(now())
  updatedAt        DateTime          @updatedAt
  // One-to-many with Shop
  shops            Shop[]
  // One-to-many with Product
  products         Product[]
  // Many-to-many with ProductCategory
  productCategories ProductCategory[] @relation("ShopCategoryToProductCategory")
}

// ---- shopCustomer/shopCustomer.prisma ----
model ShopCustomer {
    id String @id @default(uuid())
    shopId String
    customerId String
    creditScore Int @default(0)
    creditLimit   Float?   @default(0)  
    creditAmount  Float?   @default(0)
    shop Shop @relation(fields:[shopId], references:[id])
    customer Customer @relation(fields:[customerId], references:[id])
    customerCredits CustomerCredit[]
    orders Order[]
    @@unique([shopId, customerId])
}

// ---- shopExpense/shopExpense.prisma ----
model ShopParty {
    id      String @id @default(uuid())
    name    String
    email   String?
    phone   String?
    isDeleted Boolean @default(false)
    shopId  String
    shop    Shop @relation(fields: [shopId], references: [id])
    ShopExpenses ShopExpense[]
    createdAt DateTime @default(now())
    updatedAt DateTime @updatedAt
}
model ShopExpenseItems {
    id            String      @id @default(uuid())
    shopExpenseId String
    shopExpense   ShopExpense @relation(fields: [shopExpenseId], references: [id])
    name          String
    quantity      Int
    unitPrice     Float
    totalPrice    Float
    createdAt DateTime @default(now())
    updatedAt DateTime @updatedAt
}
model ShopExpense {
    id String @id @default(uuid())
    shopId String
    shop   Shop   @relation(fields: [shopId], references: [id])
    amount      Float
    description String?
    date        DateTime @default(now())
    createdAt DateTime @default(now())
    updatedAt DateTime @updatedAt
    partyId String?
    party   ShopParty? @relation(fields: [partyId], references: [id])
    shopExpenseItems ShopExpenseItems[]
}

// ---- shopProduct/shopProduct.prisma ----
enum UnitType {
  unit
  box
  packet
  dozen
  plate
  other
}
model ShopProduct {
  id String @id @default(uuid())
  // Foreign key to Product (optional)
  productId String?
  product   Product? @relation(fields: [productId], references: [id])
  // Foreign key to Shop (required)
  shopId String
  shop   Shop   @relation(fields: [shopId], references: [id])
  sku                String?
  current_stock_quantity      Int?      @default(0)
  minimum_stock_quantity      Int?      @default(0)
  costPrice          Float
  sellingPrice       Float
  primaryUnit        UnitType?
  secondaryUnit      String?
  conversionRate     Int?
  secondaryUnitPrice Float?
  expiryDate         DateTime?
  lowStockThreshold  Int?
  expiryAlertDays    Int?
  imageUrl          String?
  // RetroyNN additions
  name        String
  description String?
  // ItemCategory (shopproductcategory)
  shopproductcategoryId String?
  shopproductsubcategoryId String?
  shopproductcategory   ShopProductCategory? @relation(fields: [shopproductcategoryId], references: [id])
  shopproductsubcategory   ShopProductSubCategory? @relation(fields: [shopproductsubcategoryId], references: [id])
  // Addons
  addons ShopProductAddon[] @relation("ShopProductToAddon")
  // Variant relationships
  parentShopProductId String?
  parentProduct       ShopProduct?  @relation("ParentVariant", fields: [parentShopProductId], references: [id])
  variants            ShopProduct[] @relation("ParentVariant")
  isVariant          Boolean @default(false)
  isAvailable        Boolean @default(true)
  showOnCustomerMenu Boolean @default(true)
  // Raw materials
  rawMaterials ProductComponentRawMaterial[]
  productRequests ProductRequest[]
  buyOffers       Offer[]          @relation("BuyItemRelation")
  getOffers       Offer[]          @relation("GetItemRelation")
  brandId        String?
  brand          ShopProductBrand? @relation(fields: [brandId], references: [id])
  colorId        String?
  isDeleted Boolean? @default(false)
  @@unique([shopId, name])
  @@map("shop_product") // optional: match DB table name
}

// ---- shopProduct/shopProductBrand.prisma ----
model ShopProductBrand {
    id String @id @default(uuid())
    name String
    shopId    String
    shop      Shop     @relation(fields: [shopId], references: [id])
    isDeleted Boolean? @default(false)
    products ShopProduct[]
    @@unique([shopId, name])
}

// ---- shopProduct/shopProductColor.prisma ----
model ShopProductColor {
    id String @id @default(uuid())
    name      String
    hexCode   String
    shopId      String
    shop        Shop    @relation(fields: [shopId], references: [id])
    isDeleted Boolean? @default(false)
    @@unique([shopId, name])
}

// ---- shopProductAddon/shopProductAddon.prisma ----
model ShopProductAddon {
  id              String                         @id @default(uuid())
  shopProductId   String
  shopProduct     ShopProduct                    @relation("ShopProductToAddon", fields: [shopProductId], references: [id])
  name            String
  additionalPrice Float                        
  rawMaterials    ProductComponentRawMaterial[]
   productRequestAddons ProductRequestAddon[] 
  @@map("shop_product_addon") // Optional: use only if your DB table has this exact name
}

// ---- shopProductCategory/shopProductCategory.prisma ----
model ShopProductCategory {
  id                          String               @id @default(uuid())
  name                        String
  description                 String?
  // FK to Shop
  shopId String
  shop   Shop   @relation(fields: [shopId], references: [id])
  isDeleted Boolean @default(false)
  // One-to-many with ShopProduct
  shopProduct ShopProduct[]
  subCategories  ShopProductSubCategory[]
  @@map("item_category") // Optional: map to existing DB table name
}

// ---- shopProductCategory/shopProductSubCategory.prisma ----
model ShopProductSubCategory {
  id                          String               @id @default(uuid())
  name                        String
  description                 String?
  parentShopProductCategoryId        String
  parentShopProductCategory           ShopProductCategory @relation(fields: [parentShopProductCategoryId], references: [id])
  // FK to Shop
  shopId String
  shop   Shop   @relation(fields: [shopId], references: [id])
  isDeleted Boolean @default(false)
  // One-to-many with ShopProduct
  shopProduct ShopProduct[]
  @@map("item_sub_category") // Optional: map to existing DB table name
}

// ---- soundSetting/soundSetting.prisma ----
model SoundSetting {
  id                   String   @id @default(uuid())
  shopId               String   @unique
  shop                 Shop     @relation(fields: [shopId], references: [id])
  menuSelectSound      Boolean  @default(true)
  orderPlacedSound     Boolean  @default(true)
  otherSoundOption     Boolean  @default(true) // placeholder for future settings
  createdAt            DateTime @default(now())
  updatedAt            DateTime @updatedAt
}

// ---- table/table.prisma ----
model Table {
  id           String       @id @default(uuid())
  name         String
  capacity     Int
  isOccupied   Boolean      @default(false)
  floor        String?
  shopId       String
  shop         Shop         @relation(fields: [shopId], references: [id])
  tableGroupId String?
  tableGroup   TableGroup?  @relation(fields: [tableGroupId], references: [id], onDelete: SetNull)
  orders Order[]
   reservations Reservation[]  
  @@unique([name, shopId])
  @@map("table")
}

// ---- tableGroup/tableGroup.prisma ----
model TableGroup {
  id            String    @id @default(uuid())
  name          String
  totalCapacity Int
  isActive      Boolean   @default(true)
  createdAt     DateTime  @default(now())
  tables        Table[]
  orders        Order[]
  shopId        String
  shop          Shop      @relation(fields: [shopId], references: [id])
  @@map("table_group")
}

// ---- tax/tax.prisma ----
model ShopTax {
    id String @id @default(uuid())
    name String
    rate Float
    type TaxType
    createdAt DateTime @default(now())
    updatedAt DateTime @updatedAt
    isDefault Boolean   @default(false)
    shopId String
    shop         Shop         @relation(fields: [shopId], references: [id])
 @@unique([name, shopId])
}
enum TaxType{
    INCLUSIVE
    EXCLUSIVE
}

// ---- transactions/transactions.prisma ----
enum PaymentMethod {
  cash
  online
  unpaid
}
enum TransactionStatus {
  completed
  cancelled
}
enum TransactionType {
  PURCHASE
  SALE
  EXPENSE
}
model Transaction {
  id        String @id @default(uuid())
  shopId    String
  orderId   String @unique
  invoiceId String @unique
  customerId   String?
  customerName String?
  recordedBy   String? @default("merchant")
  items Json
  subtotal       Float?
  discount       Float? @default(0)
  vat            Float? @default(0)
  netTotal       Float?
  receivedAmount Float?
  balanceDue     Float?
  paymentMethod   PaymentMethod     @default(unpaid)
  status          TransactionStatus @default(completed)
  transactionType TransactionType       @default(SALE)
  notes String?
  tokenNumber Int?
  createdAt   DateTime @default(now())
  shop  Shop  @relation(fields: [shopId], references: [id])
  order Order @relation(fields: [orderId], references: [id])
  @@map("transaction")
}
model ShopTransaction {
  id        String @id @default(uuid())
  shopId    String
  orderId   String @unique
  invoiceId String @unique
  customerId   String?
  customerName String?
  recordedBy   String? @default("merchant")
  items Json
  subtotal       Float?
  discount       Float? @default(0)
  vat            Float? @default(0)
  netTotal       Float?
  receivedAmount Float?
  balanceDue     Float?
  paymentMethod PaymentMethod     @default(unpaid)
  status        TransactionStatus @default(completed)
  notes         String?
  tokenNumber Int?
  createdAt   DateTime @default(now())
  shop  Shop  @relation(fields: [shopId], references: [id])
  order Order @relation(fields: [orderId], references: [id])
}

// ---- user/user.prisma ----
enum Role {
  MERCHANT
  MANAGER
  ADMIN
  CUSTOMER
  STAFF
}
enum RequestStatus {
  PENDING
  APPROVED
  REJECTED
}
model Superadmin {
  id       String @id @default(uuid())
  name     String
  email    String @unique
  password String
}
model Merchant {
  id                    String        @id @default(uuid())
  name                  String
  email                 String        @unique
  password              String
  merchantDocuments     Json
  merchantRequestStatus RequestStatus
  phoneNumbers          Json
  userId                String        @unique
  lastLoggedInShop String?
  user User @relation("MerchantUser", fields: [userId], references: [id])
  shop Shop[]
}
model User {
  id         String   @id @default(uuid())
  email      String   @unique
  password   String
  name       String
  role       Role     @default(CUSTOMER)
  isActive   Boolean  @default(true)
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt
  isVerified Boolean  @default(true)
  gender     String?
  merchant Merchant? @relation("MerchantUser")
  customer Customer? @relation("CustomerUser")
  staff    Staff?    @relation("StaffUser")
}
model Customer {
  id            String         @id @default(uuid())
  userId        String         @unique
  address       String
  phone         String
  user          User           @relation("CustomerUser", fields: [userId], references: [id])
  shopCustomers ShopCustomer[]
}
model Staff {
  id       String @id @default(uuid())
  userId   String @unique
  position String?
  shopId   String
  permissions String[]
  phone   String?
  shop     Shop   @relation("ShopStaff", fields: [shopId], references: [id])
  user     User   @relation("StaffUser", fields: [userId], references: [id])
}